name: Nightly Network E2E

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:

concurrency:
  group: nightly-network-e2e
  cancel-in-progress: false

jobs:
  network-e2e-fuji:
    name: Network E2E (Fuji)
    runs-on: ubuntu-latest
    timeout-minutes: 90
    steps:
      - uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: "1.24"

      - name: Verify Fuji key secret is configured
        env:
          PRIVATE_KEY: ${{ secrets.E2E_FUJI_PRIVATE_KEY }}
        run: |
          if [ -z "$PRIVATE_KEY" ]; then
            echo "Missing required secret: E2E_FUJI_PRIVATE_KEY"
            exit 1
          fi

      - name: Run network e2e tests on Fuji
        env:
          RUN_E2E_NETWORK_TESTS: "1"
          PRIVATE_KEY: ${{ secrets.E2E_FUJI_PRIVATE_KEY }}
        run: >-
          go test -tags=networke2e -v ./e2e/... -network=fuji
          -run 'TestWalletCreation|TestFullWalletCreation|TestPChainSendToSelf|TestFullPToCTransfer|TestFullCToPTransfer|TestGetCurrentValidators'
